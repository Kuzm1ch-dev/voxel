use glam::{Vec2, Vec4};
use crate::render::ui::UIRenderer;

// Простой 8x8 растровый шрифт для ASCII символов
const FONT_DATA: &[u64] = &[
    0x0000000000000000, // ' ' (32)
    0x1818181800180018, // '!' (33)
    0x6666000000000000, // '"' (34)
    0x6666FF66FF666600, // '#' (35)
    0x183E603C067C1800, // '$' (36)
    0x0066AC1830D86600, // '%' (37)
    0x386C3876DCCE7600, // '&' (38)
    0x1818000000000000, // ''' (39)
    0x0C18303030180C00, // '(' (40)
    0x30180C0C0C183000, // ')' (41)
    0x00663CFF3C660000, // '*' (42)
    0x0018187E18180000, // '+' (43)
    0x0000000000181830, // ',' (44)
    0x0000007E00000000, // '-' (45)
    0x0000000000181800, // '.' (46)
    0x0306060C18306000, // '/' (47)
    0x3C666E7E76663C00, // '0' (48)
    0x1838181818187E00, // '1' (49)
    0x3C66060C18307E00, // '2' (50)
    0x3C66061C06663C00, // '3' (51)
    0x0C1C3C6C7E0C0C00, // '4' (52)
    0x7E60607C06663C00, // '5' (53)
    0x1C30607C66663C00, // '6' (54)
    0x7E060C1830303000, // '7' (55)
    0x3C66663C66663C00, // '8' (56)
    0x3C66663E060C3800, // '9' (57)
    0x0000181800181800, // ':' (58)
    0x0000181800181830, // ';' (59)
    0x0C18306030180C00, // '<' (60)
    0x00007E007E000000, // '=' (61)
    0x30180C060C183000, // '>' (62)
    0x3C66060C18001800, // '?' (63)
    0x3C666E6A6E603C00, // '@' (64)
    0x3C66667E66666600, // 'A' (65)
    0x7C66667C66667C00, // 'B' (66)
    0x3C66606060663C00, // 'C' (67)
    0x7866666666667800, // 'D' (68)
    0x7E60607C60607E00, // 'E' (69)
    0x7E60607C60606000, // 'F' (70)
    0x3C66606E66663E00, // 'G' (71)
    0x6666667E66666600, // 'H' (72)
    0x7E18181818187E00, // 'I' (73)
    0x3E0C0C0C0C6C3800, // 'J' (74)
    0x666C7870786C6600, // 'K' (75)
    0x6060606060607E00, // 'L' (76)
    0xC6EEFED6C6C6C600, // 'M' (77)
    0x66767E7E6E666600, // 'N' (78)
    0x3C66666666663C00, // 'O' (79)
    0x7C66667C60606000, // 'P' (80)
    0x3C66666666663E06, // 'Q' (81)
    0x7C66667C6C666600, // 'R' (82)
    0x3C66603C06663C00, // 'S' (83)
    0x7E18181818181800, // 'T' (84)
    0x6666666666663C00, // 'U' (85)
    0x66666666663C1800, // 'V' (86)
    0xC6C6C6D6FEEEC600, // 'W' (87)
    0x66663C183C666600, // 'X' (88)
    0x6666663C18181800, // 'Y' (89)
    0x7E060C1830607E00, // 'Z' (90)
];

pub struct BitmapFont;

impl BitmapFont {
    pub fn render_text(ui: &mut UIRenderer, text: &str, pos: Vec2, scale: f32, color: Vec4) {
        let char_width = 8.0 * scale / 800.0; // Нормализованная ширина
        let _char_height = 8.0 * scale / 600.0; // Нормализованная высота
        let pixel_size = scale / 800.0;
        
        for (i, ch) in text.chars().enumerate() {
            let char_x = pos.x + i as f32 * char_width;
            
            if ch as u32 >= 32 && ch as u32 <= 90 {
                let font_index = (ch as u32 - 32) as usize;
                if font_index < FONT_DATA.len() {
                    let bitmap = FONT_DATA[font_index];
                    
                    // Рендерим каждый пиксель символа
                    for y in 0..8 {
                        for x in 0..8 {
                            let bit = (bitmap >> (63 - (y * 8 + x))) & 1;
                            if bit == 1 {
                                let pixel_x = char_x + x as f32 * pixel_size;
                                let pixel_y = pos.y + y as f32 * pixel_size;
                                ui.add_rect(Vec2::new(pixel_x, pixel_y), Vec2::new(pixel_size, pixel_size), color);
                            }
                        }
                    }
                }
            }
        }
    }
}